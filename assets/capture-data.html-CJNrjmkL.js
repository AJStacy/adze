import{_ as l,r as p,c as i,b as s,d as n,e,w as t,a as o,o as c}from"./app-Bj3MFvFN.js";const r={},d=o('<h1 id="capturing-log-data" tabindex="-1"><a class="header-anchor" href="#capturing-log-data"><span>Capturing Log Data</span></a></h1><p>Now that we have setup our logger and configured it to our liking, we may also want to capture our log data and transport it to another source for tracking and monitoring our application.</p><p><strong>Transports</strong> are a term for moving our log data from our application to anothe source. Adze provides two ways for capturing the log data and then acting upon it to either send over the network, write to a file, or insert into a database.</p><p>The two supported methods are <strong>middleware</strong> and <strong>log listeners</strong>.</p><h2 id="middleware" tabindex="-1"><a class="header-anchor" href="#middleware"><span>Middleware</span></a></h2>',5),u=s("strong",null,"Middleware class",-1),k=s("p",null,"When the lifecycle hooks are called, they always provide the log instance which can be accessed to get its data, configuration, and formatted message, as well as any other relevant information to that hook.",-1),m=s("p",null,"The hook can then process the data and transport it to a destination, such as a file, API, or database.",-1),h=o(`<p>As an example, let&#39;s take a look at adding middleware to a logger that transports data to a local file and rotates the file on a specified interval. We&#39;ll use the <a href="https://github.com/adzejs/transport-file" target="_blank" rel="noopener noreferrer">@adze/transport-file</a> middleware package to handle this.</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> adze<span class="token punctuation">,</span> <span class="token punctuation">{</span> setup <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;adze&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> AdzeFileTransport <span class="token keyword">from</span> <span class="token string">&#39;@adze/transport-file&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// First, we will create an instance of our file transport. We&#39;ll rotate our log file every 12 hours.</span></span>
<span class="line"><span class="token keyword">const</span> fileTransport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AdzeTransportFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span> directory<span class="token operator">:</span> <span class="token string">&#39;./logs&#39;</span><span class="token punctuation">,</span> frequency<span class="token operator">:</span> <span class="token string">&#39;12h&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Next, we call the load method.</span></span>
<span class="line"><span class="token comment">// This is necessary for our middleware to conditionally load its dependencies based on the runtime environment.</span></span>
<span class="line"><span class="token comment">// File transports are only relative to server environments.</span></span>
<span class="line"><span class="token keyword">await</span> fileTransport<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Now, we&#39;ll setup Adze and provide the middleware instance.</span></span>
<span class="line"><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  middleware<span class="token operator">:</span> <span class="token punctuation">[</span>fileTransport<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> logger <span class="token operator">=</span> adze<span class="token punctuation">.</span>timestamp<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> logger<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Pay special attention to how the AdzeTransportFile middleware class is used. First, it is instantiated with some options. Second, we must call the <code>load</code> method.</p><p>We must call the <code>load</code> method because Adze is isomorphic and support both the browser and server out of the box. The dependencies that AdzeTransportFile uses under the hood can only be loaded in a server environment. The <code>load</code> method allows the middleware to load these dependencies only if it is in a server environment, thus prevent errors from occuring in the browser.</p><h2 id="log-listeners" tabindex="-1"><a class="header-anchor" href="#log-listeners"><span>Log Listeners</span></a></h2><p>Another method of capturing or reacting to logs is by using log listeners. Log listeners are callback functions that are called when a log has been terminated. They have less capability than middleware for hooking into the log lifecycle, but are much simpler to implement and can be handy for simple use cases.</p><p>Let&#39;s take a look at how to set up a listener.</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> adze<span class="token punctuation">,</span> <span class="token punctuation">{</span> setup <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;adze&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// When the setup function is called, it returns a reference to the Adze global store.</span></span>
<span class="line"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// From our store reference we can add one or more listeners that target specific log levels.</span></span>
<span class="line"><span class="token comment">// The first one here will target all log levels by passing the \`&#39;*&#39;\` wildcard.</span></span>
<span class="line"><span class="token keyword">const</span> allListenerId <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>log<span class="token operator">:</span> Log<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> data <span class="token operator">=</span> log<span class="token punctuation">.</span>data<span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// Do something with the log instance...</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Let&#39;s add another listener that only targets alerts.</span></span>
<span class="line"><span class="token keyword">const</span> alertListenerId <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&#39;alert&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>log<span class="token operator">:</span> Log<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// Do something with the alert log such as triggering a notification.</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> logger <span class="token operator">=</span> adze<span class="token punctuation">.</span>timestamp<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> logger<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8),g=o(`<p>Also notice that the <code>addListener</code> returns the ID for the registered listener. You can use this ID elsewhere in your application to remove the listeners if necessary.</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">const</span> allListenerId <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>log<span class="token operator">:</span> Log<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// Do something with the log instance...</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// elsewhere in your application...</span></span>
<span class="line">store<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span>allListenerId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2);function v(f,w){const a=p("RouteLink");return c(),i("div",null,[d,s("p",null,[n("Middleware can be created by extending the base "),u,n(" that is provided by Adze. The Middleware class allows you to hook into various points in the "),e(a,{to:"/reference/introduction.html#lifecycle"},{default:t(()=>[n("Adze log lifecycle")]),_:1}),n(".")]),k,m,s("p",null,[n("For more information about creating middleware, please visit the "),e(a,{to:"/reference/middleware.html"},{default:t(()=>[n("middleware")]),_:1}),n(" page in the "),e(a,{to:"/reference/introduction.html"},{default:t(()=>[n("Reference Manual")]),_:1}),n(".")]),h,s("p",null,[n("In the above example we have created two log listeners. One targets all logs and the other targets only alert logs. You can also target logs with a number array that represents specific log levels or a string array of log level names. For more information on targeting levels, refer to the "),e(a,{to:"/reference/introduction.html"},{default:t(()=>[n("Reference Manual")]),_:1}),n(" on "),e(a,{to:"/reference/configuration.html#levelselector-type"},{default:t(()=>[n("LevelSelector's")]),_:1}),n(".")]),g])}const y=l(r,[["render",v],["__file","capture-data.html.vue"]]),_=JSON.parse('{"path":"/getting-started/capture-data.html","title":"Capturing Log Data","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Middleware","slug":"middleware","link":"#middleware","children":[]},{"level":2,"title":"Log Listeners","slug":"log-listeners","link":"#log-listeners","children":[]}],"git":{"updatedTime":1726004801000,"contributors":[{"name":"Andrew Stacy","email":"ajstacy@gmail.com","commits":1}]},"filePathRelative":"getting-started/capture-data.md","excerpt":"\\n<p>Now that we have setup our logger and configured it to our liking, we may also want to capture our\\nlog data and transport it to another source for tracking and monitoring our application.</p>\\n<p><strong>Transports</strong> are a term for moving our log data from our application to anothe source. Adze\\nprovides two ways for capturing the log data and then acting upon it to either send over the\\nnetwork, write to a file, or insert into a database.</p>"}');export{y as comp,_ as data};
